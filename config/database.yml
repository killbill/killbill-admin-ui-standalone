development: &default
<% if defined?(JRUBY_VERSION) %>
<% adapter = ENV['KAUI_DB_ADAPTER'] || java.lang.System.getProperty('kaui.db.adapter', 'mariadb') %>
  adapter: <%= adapter %>
  encoding: <%= ENV['KAUI_DB_ENCODING'] || java.lang.System.getProperty('kaui.db.encoding', 'utf8') %>
<% if adapter == 'sqlite3' %>
  database: <%= ENV['KAUI_DB_DATABASE'] || java.lang.System.getProperty('kaui.db.database', '/var/tmp/kaui.sqlite3') %>
  pool: 50
  timeout: 5000
<% else %>
  url: <%= ENV['KAUI_DB_URL'] || java.lang.System.getProperty('kaui.db.url', 'jdbc:mariadb://localhost:3306/kaui?useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC') %>
  username: <%= ENV['KAUI_DB_USERNAME'] || java.lang.System.getProperty('kaui.db.username', 'root') %>
  password: <%= ENV['KAUI_DB_PASSWORD'] || java.lang.System.getProperty('kaui.db.password', 'root') %>
  host: <%= ENV['KAUI_DB_HOST'] || java.lang.System.getProperty('kaui.db.host') %>
  port: <%= ENV['KAUI_DB_PORT'] || java.lang.System.getProperty('kaui.db.port') %>
  pool: <%= ENV['KAUI_DB_POOL'] || java.lang.System.getProperty('kaui.db.pool', '50') %>
  timeout: <%= ENV['KAUI_DB_TIMEOUT'] || java.lang.System.getProperty('kaui.db.timeout', '5000') %>
<% end %>
<% else %>
  adapter: mysql2
  encoding: utf8
  database: <%= ENV['RAILS_DATABASE'] || 'kaui' %>
  username: <%= ENV['RAILS_DATABASE_USERNAME'] || 'root' %>
  password: <%= ENV['RAILS_DATABASE_PASSWORD'] || 'root' %>
  host: <%= ENV['RAILS_DATABASE_HOST'] || '127.0.0.1' %>
  port: <%= ENV['RAILS_DATABASE_PORT'] || 3306 %>
  pool: 50
  timeout: 5000
<% end %>

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
<% if defined?(JRUBY_VERSION) %>
<% adapter = ENV['DB_ADAPTER'] || java.lang.System.getProperty('kaui.db.adapter', 'mariadb') %>
  adapter: <%= adapter %>
<% if adapter == 'mariadb' %>
  url: <%= ENV['DB_URL'] || java.lang.System.getProperty('kaui.db.url', 'jdbc:mariadb://localhost:3306/kaui_test?useUnicode=true&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC') %>
<% end %>
<% else %>
  adapter: <%= ENV.fetch('DB_ADAPTER', 'mysql2') %>
<% end %>
  encoding: utf8
  username: <%= ENV.fetch('DB_USER', 'root') %>
  password: <%= ENV.fetch('DB_PASSWORD', 'root') %>
  host: <%= ENV.fetch('DB_HOST', '127.0.0.1') %>
  port: <%= ENV.fetch('DB_PORT', '3306') %>
  pool: 25
  timeout: 5000
  # Work around broken PostgreSQL activerecord-jdbc-adapter on Rails 5
  insert_returning: false
  # MariaDB (see lib/arjdbc/mysql/connection_methods.rb)
  useSsl: false
  # MySQL
  requireSSL: false
  useSSL: false
  database: <%= ENV.fetch('DB_NAME', 'kaui_test') %>

production:
  <<: *default
